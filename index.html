<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Martial Peak Reader</title>
  <style>
    :root[data-theme="light"] {
      --bg: #ffffff;
      --fg: #000000;
      --sidebar-bg: #f5f5f5;
    }
    :root[data-theme="dark"] {
      --bg: #111111;
      --fg: #eeeeee;
      --sidebar-bg: #222222;
    }
    body {
      margin: 0;
      font-family: sans-serif;
      background: var(--bg);
      color: var(--fg);
      display: flex;
      min-height: 100vh;
    }
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 250px;
      height: 100%;
      background: var(--sidebar-bg);
      overflow-y: auto;
      transform: translateX(-100%);
      transition: transform 0.3s;
      z-index: 1001;
    }
    .sidebar.open { transform: translateX(0); }
    .overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      display: none;
      z-index: 1000;
    }
    .overlay.show { display: block; }
    header {
      position: fixed;
      top: 0; left: 0;
      right: 0;
      height: 50px;
      background: var(--sidebar-bg);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1rem;
      z-index: 1002;
    }
    .menu {
      background: none;
      border: none;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      gap: 5px;
      padding: 5px;
    }
    .menu span {
      display: block;
      width: 25px;
      height: 3px;
      background: var(--fg);
      border-radius: 2px;
      transition: background 0.3s;
    }
    main {
      margin-top: 60px;
      flex: 1;
      padding: 1rem;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }
    .nav {
      display: flex;
      justify-content: space-between;
      margin: 1rem 0;
    }
    .nav a {
      text-decoration: none;
      color: var(--fg);
    }
  </style>
</head>
<body>
  <div class="sidebar" id="sidebar">
    <ul id="chapterList"></ul>
  </div>
  <div class="overlay" id="overlay"></div>
  <header>
    <button class="menu" id="menuBtn" aria-label="Menu">
      <span></span><span></span><span></span>
    </button>
    <button id="themeBtn">üåô</button>
  </header>
  <main>
    <div class="nav top-nav">
      <a href="#" id="prevBtnTop" class="hidden">‚Üê Prev</a>
      <a href="#" id="nextBtnTop" class="hidden">Next ‚Üí</a>
    </div>
    <article id="article" class="article"></article>
    <div class="nav bottom-nav">
      <a href="#" id="prevBtn" class="hidden">‚Üê Prev</a>
      <a href="#" id="nextBtn" class="hidden">Next ‚Üí</a>
    </div>
  </main>
  <script>
    const sidebar = document.getElementById("sidebar");
    const overlay = document.getElementById("overlay");
    const menuBtn = document.getElementById("menuBtn");
    const themeBtn = document.getElementById("themeBtn");
    const article = document.getElementById("article");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const prevBtnTop = document.getElementById("prevBtnTop");
    const nextBtnTop = document.getElementById("nextBtnTop");
    const chapterList = document.getElementById("chapterList");

    // Sidebar toggle
    menuBtn.addEventListener("click", () => {
      sidebar.classList.toggle("open");
      overlay.classList.toggle("show");
    });
    overlay.addEventListener("click", () => {
      sidebar.classList.remove("open");
      overlay.classList.remove("show");
    });

    // Theme toggle
    function setTheme(mode) {
      document.documentElement.setAttribute("data-theme", mode);
      localStorage.setItem("theme", mode);
      themeBtn.textContent = mode === "light" ? "üåô" : "‚òÄÔ∏è";
    }
    function toggleTheme() {
      const current = localStorage.getItem("theme") || "light";
      const next = current === "light" ? "dark" : "light";
      setTheme(next);
    }
    themeBtn.addEventListener("click", toggleTheme);
    setTheme(localStorage.getItem("theme") || "light");

    // Fetch chapter list
    let chapters = [];
    let currentIndex = 0;
    async function loadChapters() {
      const res = await fetch("chapters.json");
      chapters = await res.json();
      chapterList.innerHTML = "";
      chapters.forEach((ch, i) => {
        const li = document.createElement("li");
        const a = document.createElement("a");
        a.href = "#";
        a.textContent = ch.title;
        a.addEventListener("click", () => {
          loadChapter(i);
          sidebar.classList.remove("open");
          overlay.classList.remove("show");
        });
        li.appendChild(a);
        chapterList.appendChild(li);
      });
      if (chapters.length > 0) loadChapter(0);
    }

    async function loadChapter(index) {
      currentIndex = index;
      const ch = chapters[index];
      const res = await fetch(ch.file);
      const text = await res.text();
      article.innerHTML = text;

      // Update nav buttons (both top and bottom)
      function updateBtn(btn, idx) {
        if (idx >= 0 && idx < chapters.length) {
          btn.classList.remove("hidden");
          btn.href = "#";
          btn.onclick = (e) => {
            e.preventDefault();
            loadChapter(idx);
          };
        } else {
          btn.classList.add("hidden");
        }
      }
      updateBtn(prevBtn, index - 1);
      updateBtn(nextBtn, index + 1);
      updateBtn(prevBtnTop, index - 1);
      updateBtn(nextBtnTop, index + 1);
    }

    loadChapters();
  </script>
</body>
</html>